"use strict";(self.webpackChunkjet_fighters_online_2_0=self.webpackChunkjet_fighters_online_2_0||[]).push([[708],{708:function(e,n,t){t.r(n),t.d(n,{default:function(){return T}});var r=t(592),a=t(264),s=t(142),o=t(683),i=t(152),c=t(791),u=t(871),l={joiner:{name:"_____ ",score:0},owner:{name:"_____ ",score:0},settings:{scoreMax:"0",widthMap:600,heightMap:300}},f=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window,r=(0,c.useRef)();(0,c.useEffect)((function(){console.log("effect runs"),r.current=n}),[n]),(0,c.useEffect)((function(){if(t&&t.addEventListener){var n=function(e){return r.current(e)};return console.log("".concat(e," event added")),t.addEventListener(e,n),function(){t.removeEventListener(e,n),console.log("".concat(e," event removed"))}}console.log("Element doesn't support addEventListener")}),[e,t])},d=function(e,n,t){var r=n.scale,a=n.x,s=n.y,o=-(n.angle*Math.PI/180+Math.PI);e.setTransform(r,0,0,r,a,s),e.rotate(o),e.drawImage(t,-t.width/2,-t.height/2)},m=t(80),v="Game_game__8rvLL",p=t(184),w=function(e,n,t){!function(e){e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height)}(e),function(e,n){for(var t=n.owner,r=n.joiner,a=0;a<t.bullets.length;a+=1)e.fillStyle=t.bullets[a].color,e.fillRect(t.bullets[a].x,t.bullets[a].y,4,4);for(var s=0;s<r.bullets.length;s+=1)e.fillStyle=r.bullets[s].color,e.fillRect(r.bullets[s].x,r.bullets[s].y,4,4)}(e,n),function(e,n,t){var r=n.owner,a=n.joiner,s=t.imgJetOwner,o=t.imgJetJoiner;d(e,r,s),d(e,a,o)}(e,n,t)},_=function(e){var n=e.stateGame;console.log("Render: <Game />");var t=(0,c.useRef)(),r=(0,c.useRef)(null);(0,c.useEffect)((function(){if(n.settings.idLobby){var e=new Image;e.src=m.N[n.owner.typeJet].imgJet;var t=new Image;t.src=m.N[n.joiner.typeJet].imgJet,r.current={imgJetOwner:e,imgJetJoiner:t}}}),[]),(0,c.useEffect)((function(){if(n.settings.idLobby){var e,a=t.current.getContext("2d");return function t(){w(a,n,r.current),e=requestAnimationFrame(t)}(),function(){cancelAnimationFrame(e)}}}));var a=n.settings,s=a.widthMap,o=a.heightMap;return(0,p.jsx)("canvas",{ref:t,width:s,height:o,className:v,children:"Game screen"})},g="Header_header__ldbyd",h=function(e){var n=e.text;return(0,p.jsx)("h2",{className:g,children:n})},b="Player_wrapper__n4edA",y="Player_name__8pYnT",j="Player_ball__VKkU3",Z="Player_jetType__MJuvK",x="Player_wrapperColor__HId0W",E="Player_textColor__1K3tt",J="Player_squareColor__o7tJg",L=function(e){var n=e.player,t=n.name,r=n.score,a=n.typeJet;return(0,p.jsxs)("div",{className:b,children:[(0,p.jsx)("div",{className:j}),(0,p.jsxs)("p",{className:y,children:[t,": ",r]}),(0,p.jsxs)("p",{className:Z,children:["Jet type: ",a]}),(0,p.jsxs)("div",{className:x,children:[(0,p.jsx)("p",{className:E,children:"Color:"}),(0,p.jsx)("div",{style:{backgroundColor:n.color},className:J})]})]})},O="TablePlayers_table__MmT9u",N=function(e){var n=e.stateGame,t=n.owner,r=n.joiner,a=n.settings.scoreMax;return(0,p.jsxs)("div",{className:O,children:[(0,p.jsx)(h,{text:"Max score: ".concat(a)}),(0,p.jsx)(L,{player:t}),(0,p.jsx)(L,{player:r})]})},A={wrapper:"Countdown_wrapper__b27ED"},G=function(e){var n=e.handleCountownEnd,t=(0,c.useState)(3),r=(0,i.Z)(t,2),a=r[0],s=r[1];return(0,c.useEffect)((function(){var e=setInterval((function(){s((function(e){return e-1}))}),1e3);return function(){clearInterval(e)}}),[]),(0,c.useLayoutEffect)((function(){a<1&&n()})),(0,p.jsx)("div",{className:A.wrapper,children:(0,p.jsx)("div",{className:A.count,children:a})})},P="GameOver_wrapper__c3ItD",R=function(e){var n=e.winner,t=e.isOwnerLobby,r=e.handleGameOverEnd;console.log(n,t,r),(0,c.useEffect)((function(){var e=setTimeout((function(){r()}),3e3);return function(){clearInterval(e),r()}}),[r]);var a="joiner"===n?"You Win":"You Lose";return t&&(a="owner"===n?"You Win":"You Lose"),"draw"===n&&(a="It's a draw"),(0,p.jsx)("div",{className:P,children:a})},C="Overlay_wrapper__BWZYG",M=function(){var e=(0,r.m)(),n=(0,i.Z)(e,2),t=n[0],c=n[1],l=(0,a.js)(),f=(0,i.Z)(l,1)[0],d=(0,s.J)().sendMessage,m=(0,u.s0)(),v=t.stateApp,w=t.isOwnerLobby,_=t.winner,g=f.idLobby,h="countdown"===v,b="gameOver"===v;return(0,p.jsxs)("div",{className:C,children:[h&&(0,p.jsx)(G,{handleCountownEnd:function(){if(w)return d({event:"countdownEnd",idLobby:g}),void c((function(e){return(0,o.Z)((0,o.Z)({},e),{},{stateApp:"game"})}));c((function(e){return(0,o.Z)((0,o.Z)({},e),{},{stateApp:"game"})}))}}),b&&(0,p.jsx)(R,{winner:_,isOwnerLobby:w,handleGameOverEnd:function(){c((function(e){return(0,o.Z)((0,o.Z)({},e),{},{stateApp:"lobby"})})),m("/lobby")}})]})},k="PageGame_pageGame__4pe1X",T=function(){var e=function(){var e=(0,u.TH)().state,n=(0,r.m)(),t=(0,i.Z)(n,2),f=t[0],d=t[1],m=(0,a.js)(),v=(0,i.Z)(m,2),p=v[0],w=v[1],_=(0,s.J)(),g=_.message,h=_.resetMessage,b=(0,u.s0)(),y=f.stateApp,j=g.event,Z=g.stateGame||e||l,x="countdown"===y,E="game"===y;return(0,c.useEffect)((function(){if(E&&"updateGame"===j&&console.log("EVENT: updateGame"),(E||x)&&"quitJoiner"===j&&(console.log("EVENT: quitJoiner"),d((function(e){return(0,o.Z)((0,o.Z)({},e),{},{stateApp:"lobby",msgPopup:"".concat(p.nameJoiner," has quit/disconnected.")})})),w((function(e){return(0,o.Z)((0,o.Z)({},e),{},{nameJoiner:"Empty...",isConnectedJoiner:!1,isReadyJoiner:!1})})),h(),b("/lobby")),(E||x)&&"quitOwner"===j&&(console.log("EVENT: quitOwner"),d((function(e){return(0,o.Z)((0,o.Z)({},e),{},{stateApp:"preLobby",msgPopup:"".concat(p.nameOwner," has quit/disconnected.")})})),w((0,o.Z)({},a._k)),h(),b("/")),E&&"gameOver"===j){console.log("EVENT: gameOver");var e=g.winner,n=g.winsOwner,t=g.winsJoiner;console.log("Winner: ",e),d((function(n){return(0,o.Z)((0,o.Z)({},n),{},{stateApp:"gameOver",winner:e})})),w((function(e){return(0,o.Z)((0,o.Z)({},e),{},{winsOwner:n,winsJoiner:t,isReadyOwner:!1,isReadyJoiner:!1})}))}}),[g]),Z}();return function(){var e=(0,r.m)(),n=(0,i.Z)(e,1)[0],t=(0,s.J)().sendMessage,a=n.stateApp,u=n.isOwnerLobby,l="game"===a,d=(0,c.useCallback)((function(e){if(l){if(e.preventDefault(),e.repeat)return;var n={event:"input",isOwnerLobby:u};switch(e.key){case"ArrowRight":return void t((0,o.Z)((0,o.Z)({},n),{},{isPressedRight:!0}));case"ArrowLeft":return void t((0,o.Z)((0,o.Z)({},n),{},{isPressedLeft:!0}));case" ":t((0,o.Z)((0,o.Z)({},n),{},{isPressedFire:!0}))}}}),[u,l,t]),m=(0,c.useCallback)((function(e){if(l){if(e.preventDefault(),e.repeat)return;var n={event:"input",isOwnerLobby:u};switch(e.key){case"ArrowRight":return void t((0,o.Z)((0,o.Z)({},n),{},{isReleasedRight:!0}));case"ArrowLeft":t((0,o.Z)((0,o.Z)({},n),{},{isReleasedLeft:!0}))}}}),[u,l,t]);f("keydown",d),f("keyup",m)}(),(0,p.jsxs)("main",{className:k,children:[(0,p.jsx)(_,{stateGame:e}),(0,p.jsx)(N,{stateGame:e}),(0,p.jsx)(M,{})]})}}}]);
//# sourceMappingURL=708.c61622b3.chunk.js.map