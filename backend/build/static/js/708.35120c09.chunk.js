"use strict";(self.webpackChunkjet_fighters_online_2_0=self.webpackChunkjet_fighters_online_2_0||[]).push([[708,486],{9486:function(e,n,t){t.r(n),t.d(n,{default:function(){return s}});var r="PageNonexistent_pageNonexistent__d63Rr",a=t(184),s=function(){return(0,a.jsx)("div",{className:r,children:"PageNonexistent"})}},4708:function(e,n,t){t.r(n),t.d(n,{default:function(){return Y}});var r=t(885),a=t(8592),s=t(1413),o=t(2791),i=t(6871),c=t(7264),u=t(2142),l={joiner:{name:"_____ ",score:0},owner:{name:"_____ ",score:0},settings:{scoreMax:"0",widthMap:600,heightMap:300}},f=function(){var e=(0,i.TH)().state,n=(0,a.m)(),t=(0,r.Z)(n,2),f=t[0],d=t[1],m=(0,c.js)(),v=(0,r.Z)(m,2),p=v[0],_=v[1],g=(0,u.J)(),w=g.message,h=g.resetMessage,b=(0,i.s0)(),y=f.stateApp,x=w.event,j=w.stateGame||e||l,Z="countdown"===y,E="game"===y;return(0,o.useEffect)((function(){if(E&&"updateGame"===x&&console.log("EVENT: updateGame"),(E||Z)&&"quitJoiner"===x&&(console.log("EVENT: quitJoiner"),d((function(e){return(0,s.Z)((0,s.Z)({},e),{},{stateApp:"lobby",msgPopup:"".concat(p.nameJoiner," has quit/disconnected.")})})),_((function(e){return(0,s.Z)((0,s.Z)({},e),{},{nameJoiner:"Empty...",isConnectedJoiner:!1,isReadyJoiner:!1})})),h(),b("/lobby")),(E||Z)&&"quitOwner"===x&&(console.log("EVENT: quitOwner"),d((function(e){return(0,s.Z)((0,s.Z)({},e),{},{stateApp:"preLobby",msgPopup:"".concat(p.nameOwner," has quit/disconnected.")})})),_((0,s.Z)({},c._k)),h(),b("/")),E&&"gameOver"===x){console.log("EVENT: gameOver");var e=w.winner,n=w.winsOwner,t=w.winsJoiner;console.log("Winner: ",e),d((function(n){return(0,s.Z)((0,s.Z)({},n),{},{stateApp:"gameOver",winner:e})})),_((function(e){return(0,s.Z)((0,s.Z)({},e),{},{winsOwner:n,winsJoiner:t,isReadyOwner:!1,isReadyJoiner:!1})}))}}),[w]),j},d=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window,r=(0,o.useRef)();(0,o.useEffect)((function(){console.log("effect runs"),r.current=n}),[n]),(0,o.useEffect)((function(){if(t&&t.addEventListener){var n=function(e){return r.current(e)};return console.log("".concat(e," event added")),t.addEventListener(e,n),function(){t.removeEventListener(e,n),console.log("".concat(e," event removed"))}}console.log("Element doesn't support addEventListener")}),[e,t])},m=function(){var e=(0,a.m)(),n=(0,r.Z)(e,1)[0],t=(0,u.J)().sendMessage,i=n.stateApp,c=n.isOwnerLobby,l="game"===i,f=(0,o.useCallback)((function(e){if(l){if(e.preventDefault(),e.repeat)return;var n={event:"input",isOwnerLobby:c};switch(e.key){case"ArrowRight":return void t((0,s.Z)((0,s.Z)({},n),{},{isPressedRight:!0}));case"ArrowLeft":return void t((0,s.Z)((0,s.Z)({},n),{},{isPressedLeft:!0}));case" ":t((0,s.Z)((0,s.Z)({},n),{},{isPressedFire:!0}))}}}),[c,l,t]),m=(0,o.useCallback)((function(e){if(l){if(e.preventDefault(),e.repeat)return;var n={event:"input",isOwnerLobby:c};switch(e.key){case"ArrowRight":return void t((0,s.Z)((0,s.Z)({},n),{},{isReleasedRight:!0}));case"ArrowLeft":t((0,s.Z)((0,s.Z)({},n),{},{isReleasedLeft:!0}))}}}),[c,l,t]);d("keydown",f),d("keyup",m)},v=t(9486),p=function(e,n,t){var r=n.scale,a=n.x,s=n.y,o=-(n.angle*Math.PI/180+Math.PI);e.setTransform(r,0,0,r,a,s),e.rotate(o),e.drawImage(t,-t.width/2,-t.height/2)},_=t(6080),g="Game_game__8rvLL",w=t(184),h=function(e,n,t){!function(e){e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height)}(e),function(e,n){for(var t=n.owner,r=n.joiner,a=0;a<t.bullets.length;a+=1)e.fillStyle=t.bullets[a].color,e.fillRect(t.bullets[a].x,t.bullets[a].y,4,4);for(var s=0;s<r.bullets.length;s+=1)e.fillStyle=r.bullets[s].color,e.fillRect(r.bullets[s].x,r.bullets[s].y,4,4)}(e,n),function(e,n,t){var r=n.owner,a=n.joiner,s=t.imgJetOwner,o=t.imgJetJoiner;p(e,r,s),p(e,a,o)}(e,n,t)},b=function(e){var n=e.stateGame;console.log("Render: <Game />");var t=(0,o.useRef)(),r=(0,o.useRef)(null);(0,o.useEffect)((function(){if(n.settings.idLobby){var e=new Image;e.src=_.N[n.owner.typeJet].imgJet;var t=new Image;t.src=_.N[n.joiner.typeJet].imgJet,r.current={imgJetOwner:e,imgJetJoiner:t}}}),[]),(0,o.useEffect)((function(){if(n.settings.idLobby){var e,a=t.current.getContext("2d");return function t(){h(a,n,r.current),e=requestAnimationFrame(t)}(),function(){cancelAnimationFrame(e)}}}));var a=n.settings,s=a.widthMap,i=a.heightMap;return(0,w.jsx)("canvas",{ref:t,width:s,height:i,className:g,children:"Game screen"})},y="Header_header__ldbyd",x=function(e){var n=e.text;return(0,w.jsx)("h2",{className:y,children:n})},j="Player_wrapper__n4edA",Z="Player_name__8pYnT",E="Player_ball__VKkU3",J="Player_jetType__MJuvK",L="Player_wrapperColor__HId0W",N="Player_textColor__1K3tt",O="Player_squareColor__o7tJg",P=function(e){var n=e.player,t=n.name,r=n.score,a=n.typeJet;return(0,w.jsxs)("div",{className:j,children:[(0,w.jsx)("div",{className:E}),(0,w.jsxs)("p",{className:Z,children:[t,": ",r]}),(0,w.jsxs)("p",{className:J,children:["Jet type: ",a]}),(0,w.jsxs)("div",{className:L,children:[(0,w.jsx)("p",{className:N,children:"Color:"}),(0,w.jsx)("div",{style:{backgroundColor:n.color},className:O})]})]})},A="TablePlayers_table__MmT9u",R=function(e){var n=e.stateGame,t=n.owner,r=n.joiner,a=n.settings.scoreMax;return(0,w.jsxs)("div",{className:A,children:[(0,w.jsx)(x,{text:"Max score: ".concat(a)}),(0,w.jsx)(P,{player:t}),(0,w.jsx)(P,{player:r})]})},G={wrapper:"Countdown_wrapper__b27ED"},C=function(e){var n=e.handleCountownEnd,t=(0,o.useState)(3),a=(0,r.Z)(t,2),s=a[0],i=a[1];return(0,o.useEffect)((function(){var e=setInterval((function(){i((function(e){return e-1}))}),1e3);return function(){clearInterval(e)}}),[]),(0,o.useLayoutEffect)((function(){s<1&&n()})),(0,w.jsx)("div",{className:G.wrapper,children:(0,w.jsx)("div",{className:G.count,children:s})})},M="GameOver_wrapper__c3ItD",k=function(e){var n=e.winner,t=e.isOwnerLobby,r=e.handleGameOverEnd;console.log(n,t,r),(0,o.useEffect)((function(){var e=setTimeout((function(){r()}),3e3);return function(){clearInterval(e),r()}}),[r]);var a="joiner"===n?"You Win":"You Lose";return t&&(a="owner"===n?"You Win":"You Lose"),"draw"===n&&(a="It's a draw"),(0,w.jsx)("div",{className:M,children:a})},T="Overlay_wrapper__BWZYG",I=function(){var e=(0,a.m)(),n=(0,r.Z)(e,2),t=n[0],o=n[1],l=(0,c.js)(),f=(0,r.Z)(l,1)[0],d=(0,u.J)().sendMessage,m=(0,i.s0)(),v=t.stateApp,p=t.isOwnerLobby,_=t.winner,g=f.idLobby,h="countdown"===v,b="gameOver"===v;return(0,w.jsxs)("div",{className:T,children:[h&&(0,w.jsx)(C,{handleCountownEnd:function(){if(p)return d({event:"countdownEnd",idLobby:g}),void o((function(e){return(0,s.Z)((0,s.Z)({},e),{},{stateApp:"game"})}));o((function(e){return(0,s.Z)((0,s.Z)({},e),{},{stateApp:"game"})}))}}),b&&(0,w.jsx)(k,{winner:_,isOwnerLobby:p,handleGameOverEnd:function(){o((function(e){return(0,s.Z)((0,s.Z)({},e),{},{stateApp:"lobby"})})),m("/lobby")}})]})},q="PageGame_pageGame__4pe1X",Y=function(){var e=(0,a.m)(),n=(0,r.Z)(e,1)[0],t=f();m();var s=n.stateApp;return s&&"lobby"!==s&&"preLobby"!==s?(0,w.jsxs)("main",{className:q,children:[(0,w.jsx)(b,{stateGame:t}),(0,w.jsx)(R,{stateGame:t}),(0,w.jsx)(I,{})]}):(0,w.jsx)(v.default,{})}}}]);
//# sourceMappingURL=708.35120c09.chunk.js.map